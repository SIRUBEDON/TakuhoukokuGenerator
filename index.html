<!DOCTYPE html>
<html lang="ja" class="h-full bg-gray-50">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å“å ±å‘Šã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ (æœ€çµ‚å®Œæˆç‰ˆ v11)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
    #previewOutput { white-space: pre-wrap; word-wrap: break-word; min-height: 300px; }
    .option-label.selected {
      background-color: #e0e7ff; /* indigo-100 */
      border-color: #6366f1; /* indigo-500 */
      box-shadow: 0 0 0 2px #a5b4fc;
    }
    .section {
      background-color: white;
      border-radius: 0.5rem;
      padding: 1.25rem;
      box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    }
  </style>
</head>
<body class="h-full text-gray-800">
  <div class="flex flex-col lg:flex-row min-h-screen">

    <!-- å·¦å´: å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
    <div class="lg:w-1/2 p-6 lg:p-8 space-y-6 overflow-y-auto">
      <header class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900">å“å ±å‘Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        <p class="text-sm text-gray-600 mt-1">å…¥åŠ›å†…å®¹ã‚’ä¿æŒã—ã¤ã¤ã€å¤šå½©ãªè¡¨ç¾ãŒå¯èƒ½ã§ã™ã€‚</p>
      </header>

      <div class="space-y-6">
        <!-- ã‚·ã‚¹ãƒ†ãƒ  -->
        <div class="section">
          <label for="systemSelect" class="label text-lg font-semibold text-gray-800">ã‚·ã‚¹ãƒ†ãƒ </label>
          <select id="systemSelect" name="system" class="mt-2 w-full p-2 border bg-white rounded-lg focus:ring-2 focus:ring-indigo-500">
              <option value="ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±TRPG">ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±TRPG</option>
              <option value="æ–°ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±TRPG">æ–°ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±TRPG</option>
              <option value="CoC6">CoC6</option>
              <option value="CoC7">CoC7</option>
              <option value="ã‚¨ãƒ¢ã‚¯ãƒ­ã‚¢TRPG">ã‚¨ãƒ¢ã‚¯ãƒ­ã‚¢TRPG</option>
              <option value="ãƒ€ãƒ–ãƒ«ã‚¯ãƒ­ã‚¹ The 3rd Edition">ãƒ€ãƒ–ãƒ«ã‚¯ãƒ­ã‚¹ The 3rd Edition</option>
              <option value="æ°¸ã„å¾Œæ—¥è«‡ã®ãƒã‚¯ãƒ­ãƒ‹ã‚«">æ°¸ã„å¾Œæ—¥è«‡ã®ãƒã‚¯ãƒ­ãƒ‹ã‚«</option>
              <option value="ã‚¤ãƒ³ã‚»ã‚¤ãƒ³">ã‚¤ãƒ³ã‚»ã‚¤ãƒ³</option>
              <option value="ã‚·ãƒãƒ“ã‚¬ãƒŸ">ã‚·ãƒãƒ“ã‚¬ãƒŸ</option>
              <option value="ãƒã‚®ã‚«ãƒ­ã‚®ã‚¢">ãƒã‚®ã‚«ãƒ­ã‚®ã‚¢</option>
              <option value="ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚º&ãƒ‰ãƒ©ã‚´ãƒ³ã‚º">ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚º&ãƒ‰ãƒ©ã‚´ãƒ³ã‚º(D&D)</option>
              <option value="ãƒ‘ãƒ©ãƒã‚¤ã‚¢">ãƒ‘ãƒ©ãƒã‚¤ã‚¢</option>
              <option value="ã‚½ãƒ¼ãƒ‰ãƒ»ãƒ¯ãƒ¼ãƒ«ãƒ‰2.5">ã‚½ãƒ¼ãƒ‰ãƒ»ãƒ¯ãƒ¼ãƒ«ãƒ‰2.5</option>
              <option value="other">ãã®ä»–</option>
          </select>
          <input type="text" id="systemOther" placeholder="ã‚·ã‚¹ãƒ†ãƒ åï¼ˆã€Œãã®ä»–ã€ã‚’é¸æŠï¼‰" class="mt-2 w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" style="display: none;">
        </div>

        <!-- ã‚·ãƒŠãƒªã‚ª -->
        <div class="section space-y-4">
          <label class="label text-lg font-semibold text-gray-800">ã‚·ãƒŠãƒªã‚ª</label>
          <input type="text" id="scenarioName" placeholder="ã‚·ãƒŠãƒªã‚ªå" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
          <input type="text" id="authorName" placeholder="ä½œè€…åï¼ˆä»»æ„ï¼‰" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
          <div>
            <p class="text-sm font-medium mb-2">é£¾ã‚Šæ ã‚’é¸æŠ:</p>
            <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2 text-center">
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="ã€Œã€" class="hidden" checked>ã€Œ ã€</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="ã€ã€" class="hidden">ã€ ã€</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="ã€ã€‘" class="hidden">ã€ ã€‘</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â”€â”€â”€â”€â”€â”€" class="hidden">â”€â”€</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â—¤â—¢" class="hidden">â—¤ â—¢</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â•‹â”â”â”â”â”â”â”â”" class="hidden">â•‹â”</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="ï¼Šâ”€â”€â”€â”€â”€â”€â”€" class="hidden">ï¼Šâ”€</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â€¢â€¢â”ˆâ”ˆâ”ˆâ”ˆ" class="hidden">â€¢â€¢</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="âœ¼" class="hidden">âœ¼</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="âœ¦" class="hidden">âœ¦</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â–¹â–¸" class="hidden">â–¹â–¸</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="ï¼ï¼" class="hidden">ï¼ï¼</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â–¼â–³" class="hidden">â–¼â–³</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="â˜†â˜…" class="hidden">â˜†â˜…</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="oâ—‹o" class="hidden">oâ—‹o</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="âŒ’âŒ’" class="hidden">âŒ’âŒ’</label>
                <label class="option-label p-2 border rounded-lg cursor-pointer hover:bg-gray-100 block"><input type="radio" name="scenarioFrame" value="à¬˜â™¡à¬“" class="hidden">à¬˜â™¡à¬“</label>
            </div>
          </div>
        </div>

        <!-- é€²è¡Œ -->
        <div class="section">
          <label class="label text-lg font-semibold text-gray-800">é€²è¡Œ</label>
          <select name="role" id="roleSelect" class="w-full p-2 border bg-white rounded-lg focus:ring-2 focus:ring-indigo-500 mt-2">
              <option value="KP">KP/GM + PC</option>
              <option value="KPC">KPC + PC</option>
          </select>

          <div id="standard-role-inputs" class="mt-4">
              <div class="flex space-x-4">
                  <div class="w-1/2">
                      <p class="text-sm font-medium mb-2">å½¹å‰²:</p>
                      <select name="standardRoleType" class="w-full p-2 border bg-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                          <option value="KP">KP</option><option value="GM">GM</option><option value="other">ãã®ä»–</option>
                      </select>
                  </div>
                  <div class="w-1/2">
                      <p class="text-sm font-medium mb-2">åå‰:</p>
                      <input type="text" id="roleName" placeholder="é€²è¡Œã®HN" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                  </div>
              </div>
              <input type="text" id="standardRoleTypeOther" placeholder="å½¹å‰²åï¼ˆã€Œãã®ä»–ã€ã‚’é¸æŠï¼‰" class="mt-2 w-full p-2 border rounded-lg" style="display: none;">
          </div>
          
          <div id="kpc-mode-inputs" class="mt-4" style="display: none;">
             <div class="flex space-x-4">
                <div class="w-1/2">
                    <p class="text-sm font-medium mb-2">KPCå:</p>
                    <input type="text" id="kpcName" placeholder="KPCã®åå‰" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="w-1/2">
                    <p class="text-sm font-medium mb-2">KPå:</p>
                    <input type="text" id="kpName" placeholder="KPã®HN" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
              </div>
          </div>
        </div>

        <!-- PC/HO/PL -->
        <div class="section space-y-4">
            <div class="flex items-center justify-between">
                <label class="label text-lg font-semibold text-gray-800">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</label>
                <div class="flex items-center space-x-4">
                    <button id="addPlayer" class="text-sm bg-indigo-500 text-white w-8 h-8 rounded-full hover:bg-indigo-600 transition-colors flex items-center justify-center">+</button>
                    <button id="removePlayer" class="text-sm bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600 transition-colors flex items-center justify-center">-</button>
                </div>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm font-medium mb-2">è¡¨è¨˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:</p>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="pcplFormat" value="A" class="hidden" checked>ç•ªå·ãƒ»HOåã‚ã‚Š</label>
                        <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="pcplFormat" value="B" class="hidden">ç•ªå·ãªã—ãƒ»HOåã‚ã‚Š</label>
                        <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="pcplFormat" value="C" class="hidden">ç•ªå·ã‚ã‚Šãƒ»HOåãªã—</label>
                        <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="pcplFormat" value="D" class="hidden">ãƒªã‚¹ãƒˆå½¢å¼</label>
                    </div>
                </div>
                <div id="prefix-options-wrapper">
                    <p class="text-sm font-medium mb-2">ç•ªå·ã®æ¥é ­è¾:</p>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                         <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="prefixType" value="HO" class="hidden" checked>HO</label>
                         <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="prefixType" value="PC" class="hidden">PC</label>
                    </div>
                </div>
            </div>
            <div id="players" class="space-y-4"></div>
        </div>
        
        <!-- ã‚¨ãƒ³ãƒ‰ãƒ»çµæœ -->
        <div class="section grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="label text-lg font-semibold text-gray-800">ã‚¨ãƒ³ãƒ‰</label>
                <select name="ending" class="w-full p-2 border bg-white rounded-lg focus:ring-2 focus:ring-indigo-500 mt-2">
                    <option value="">ã‚¨ãƒ³ãƒ‰ã‚’é¸æŠ</option>
                    <option value="END1">END1</option><option value="END A">END A</option><option value="other">ãã®ä»–</option>
                </select>
                <input type="text" id="endingOther" placeholder="ã‚¨ãƒ³ãƒ‰åï¼ˆã€Œãã®ä»–ã€ã‚’é¸æŠï¼‰" class="mt-2 w-full p-2 border rounded-lg" style="display: none;">
            </div>
            <div>
                <label class="label text-lg font-semibold text-gray-800">çµæœ</label>
                <select name="result" class="w-full p-2 border bg-white rounded-lg focus:ring-2 focus:ring-indigo-500 mt-2">
                    <option value="">çµæœã‚’é¸æŠ</option>
                    <option value="å…¨ç”Ÿé‚„">å…¨ç”Ÿé‚„</option><option value="ä¸¡ç”Ÿé‚„">ä¸¡ç”Ÿé‚„</option><option value="ä¸€éƒ¨ç”Ÿé‚„">ä¸€éƒ¨ç”Ÿé‚„</option>
                    <option value="å…¨ãƒ­ã‚¹ãƒˆ">å…¨ãƒ­ã‚¹ãƒˆ</option><option value="ä¸¡ãƒ­ã‚¹ãƒˆ">ä¸¡ãƒ­ã‚¹ãƒˆ</option><option value="other">ãã®ä»–</option>
                </select>
                <input type="text" id="resultOther" placeholder="çµæœè©³ç´°ï¼ˆã€Œãã®ä»–ã€ã‚’é¸æŠï¼‰" class="mt-2 w-full p-2 border rounded-lg" style="display: none;">
            </div>
        </div>

        <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
        <div class="section">
          <label class="label text-lg font-semibold text-gray-800">ãƒ•ã‚©ãƒ³ãƒˆ</label>
          <div class="radio-group mt-2 grid grid-cols-3 sm:grid-cols-4 gap-2">
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="normal" class="hidden" checked>PC/PL</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="bold-serif" class="hidden">ğğ‚/ğğ‹</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="sans-serif" class="hidden">ğ–¯ğ–¢/ğ–¯ğ–«</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="bold-sans-serif" class="hidden">ğ—£ğ—–/ğ—£ğ—Ÿ</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="italic-sans-serif" class="hidden">ğ˜—ğ˜Š/ğ˜—ğ˜“</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="script-bold" class="hidden">ğ’«ğ’/ğ’«â„’</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="script" class="hidden">ğ“Ÿğ“’/ğ“Ÿğ“›</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="monospace" class="hidden">ğ™¿ğ™²/ğ™¿ğ™»</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="fraktur" class="hidden">ğ”“â„­/ğ”“ğ”</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="double-struck" class="hidden">â„™â„‚/â„™ğ•ƒ</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="circled" class="hidden">â“…â’¸/â“…â“</label>
              <label class="option-label p-3 border rounded-lg cursor-pointer hover:bg-gray-100 text-center"><input type="radio" name="font" value="regional" class="hidden">ğŸ‡µğŸ‡¨/ğŸ‡µğŸ‡±</label>
          </div>
        </div>
        
        <!-- ã‚³ãƒ¡ãƒ³ãƒˆ -->
        <div class="section">
            <label for="comment" class="label text-lg font-semibold text-gray-800">ã‚³ãƒ¡ãƒ³ãƒˆãƒ»ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°</label>
            <textarea id="comment" placeholder="æ„Ÿæƒ³ãªã©ã‚’è‡ªç”±ã«å…¥åŠ›" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 mt-2" rows="4"></textarea>
        </div>

        <!-- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ -->
        <div class="section text-sm text-gray-600">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ & æ›´æ–°å±¥æ­´</h3>
            <div class="space-y-2">
                <p><strong>å‚è€ƒå…ƒ:</strong> <a href="https://dddddddust.github.io/trpgtakuhoukoku/" target="_blank" class="text-indigo-600 hover:underline">å“å ±å‘Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</a></p>
                <p><strong>å‚è€ƒå…ƒé–‹ç™ºè€…:</strong> ãƒ€ã‚¹ãƒˆ (<a href="https://x.com/89_556" target="_blank" class="text-indigo-600 hover:underline">@89_556</a>)</p>
                <p><strong>æ”¹è‰¯ç‰ˆä½œæˆè€…:</strong> ã—ã‚‹ã¹ (<a href="https://x.com/qxoiUioxp" target="_blank" class="text-indigo-600 hover:underline">@qxoiUioxp</a>)</p>
            </div>
            <div class="mt-4">
                <h4 class="font-semibold text-gray-700 mb-2">æ›´æ–°å±¥æ­´</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li>2024/06/25: å…¬é–‹ã€ä½œè€…åçˆ›è¿½åŠ ã€KPCãƒ¢ãƒ¼ãƒ‰è¿½åŠ </li>
                </ul>
            </div>
        </div>
      </div>
    </div>

    <!-- å³å´: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
    <div class="lg:w-1/2 bg-gray-900 text-white p-6 lg:p-8 flex flex-col sticky top-0 h-screen">
      <div class="flex-grow bg-white/5 rounded-xl p-6 overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <pre id="previewOutput" class="text-sm leading-relaxed"></pre>
      </div>
      <div class="flex-shrink-0 mt-6">
        <div class="flex justify-between items-center mb-2">
            <p id="charCount" class="text-sm font-mono">æ–‡å­—æ•°: 0</p>
            <div id="copy-status" class="text-sm text-green-400 opacity-0 transition-opacity">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
        </div>
        <button id="copyButton" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
          ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const ALL_INPUTS = 'input, select, textarea';
      const form = document.querySelector('body');
      const playersDiv = document.getElementById('players');
      let playerCount = 1;

      // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
      form.addEventListener('input', (e) => { if (e.target.closest(ALL_INPUTS)) generate(); });
      form.addEventListener('change', (e) => {
        if (e.target.closest(ALL_INPUTS)) {
            const el = e.target;
            if (el.id === 'systemSelect' || el.name === 'standardRoleType' || el.name === 'ending' || el.name === 'result') {
                toggleOtherInput(el.value, (el.id ? el.id.replace('Select', '') : el.name) + 'Other');
            }
            if(el.id === 'roleSelect') handleRoleChange();
            updatePlayerFieldsVisibility();
            updateRadioStyles(el.name);
            generate();
        }
      });

      document.getElementById('addPlayer').addEventListener('click', addPlayer);
      document.getElementById('removePlayer').addEventListener('click', removePlayer);
      document.getElementById('copyButton').addEventListener('click', copyToClipboard);
      
      // --- é–¢æ•°å®šç¾© ---
      function handleRoleChange(){
        const roleMode = document.getElementById('roleSelect').value;
        const standardInputs = document.getElementById('standard-role-inputs');
        const kpcInputs = document.getElementById('kpc-mode-inputs');
        
        if(roleMode === 'KPC') {
            standardInputs.style.display = 'none';
            kpcInputs.style.display = 'block';
        } else {
            standardInputs.style.display = 'block';
            kpcInputs.style.display = 'none';
        }
      }

      function toggleOtherInput(value, elementId) {
        const otherInput = document.getElementById(elementId);
        if (otherInput) {
          otherInput.style.display = value === 'other' ? 'block' : 'none';
          if (value !== 'other') otherInput.value = '';
        }
      }
      
      function getPlayerData() {
        const data = [];
        for (let i = 1; i <= playerCount; i++) {
            const ho = document.getElementById(`ho${i}`)?.value;
            const pc = document.getElementById(`pc${i}`)?.value;
            const pl = document.getElementById(`pl${i}`)?.value;
            data.push({ ho, pc, pl });
        }
        return data;
      }

      function reapplyPlayerData(data) {
        data.forEach((player, index) => {
            const i = index + 1;
            const hoInput = document.getElementById(`ho${i}`);
            const pcInput = document.getElementById(`pc${i}`);
            const plInput = document.getElementById(`pl${i}`);
            if (hoInput) hoInput.value = player.ho || '';
            if (pcInput) pcInput.value = player.pc || '';
            if (plInput) plInput.value = player.pl || '';
        });
      }

      function addPlayer(e) {
        e.preventDefault();
        if (playerCount < 8) {
          const currentData = getPlayerData();
          playerCount++;
          const newPlayerHTML = createPlayerHTML(playerCount);
          playersDiv.insertAdjacentHTML('beforeend', newPlayerHTML);
          reapplyPlayerData(currentData);
          updatePlayerFieldsVisibility();
        }
      }

      function removePlayer(e) {
        e.preventDefault();
        if (playerCount > 1) {
          const currentData = getPlayerData().slice(0, playerCount - 1);
          playerCount--;
          if (playersDiv.lastElementChild) playersDiv.lastElementChild.remove();
          reapplyPlayerData(currentData);
        }
      }

      function createPlayerHTML(index) {
          return `
            <div class="player-entry bg-gray-50 p-3 rounded-lg border">
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <div class="ho-field">
                  <label class="text-xs font-medium text-gray-600">HO ${index}</label>
                  <input type="text" id="ho${index}" placeholder="ä¾‹: HO1" class="w-full p-2 mt-1 border rounded-md text-sm">
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">PC ${index}</label>
                  <input type="text" id="pc${index}" placeholder="PCå" class="w-full p-2 mt-1 border rounded-md text-sm">
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">PL ${index}</label>
                  <input type="text" id="pl${index}" placeholder="PLå" class="w-full p-2 mt-1 border rounded-md text-sm">
                </div>
              </div>
            </div>`;
      }
      
      function updatePlayerFieldsVisibility() {
          const pcplFormat = document.querySelector('input[name="pcplFormat"]:checked')?.value || 'A';
          const prefixWrapper = document.getElementById('prefix-options-wrapper');
          
          const isHoRelevant = pcplFormat === 'A' || pcplFormat === 'B';
          const isPrefixRelevant = pcplFormat === 'A' || pcplFormat === 'C';

          playersDiv.querySelectorAll('.ho-field').forEach(field => {
              field.style.display = isHoRelevant ? 'block' : 'none';
          });
          
          if(prefixWrapper) {
            prefixWrapper.style.display = isPrefixRelevant ? 'block' : 'none';
          }
          generate();
      }

      function updateRadioStyles(groupName) {
        if (!groupName) return;
        document.querySelectorAll(`input[name="${groupName}"]`).forEach(r => {
          r.parentElement.classList.remove('selected');
        });
        const selected = document.querySelector(`input[name="${groupName}"]:checked`);
        if (selected) {
          selected.parentElement.classList.add('selected');
        }
      }

      const fontTransformations = {
        'normal': {},
        'bold-serif': {'A':'ğ','B':'ğ','C':'ğ‚','D':'ğƒ','E':'ğ„','F':'ğ…','G':'ğ†','H':'ğ‡','I':'ğˆ','J':'ğ‰','K':'ğŠ','L':'ğ‹','M':'ğŒ','N':'ğ','O':'ğ','P':'ğ','Q':'ğ','R':'ğ‘','S':'ğ’','T':'ğ“','U':'ğ”','V':'ğ•','W':'ğ–','X':'ğ—','Y':'ğ˜','Z':'ğ™','a':'ğ©','b':'ğ›','c':'ğœ','d':'ğ','e':'ğ','f':'ğŸ','g':'ğ ','h':'ğ¡','i':'ğ¢','j':'ğ£','k':'ğ¤','l':'ğ¥','m':'ğ¦','n':'ğ§','o':'ğ¨','p':'ğ©','q':'ğª','r':'ğ«','s':'ğ¬','t':'ğ­','u':'ğ®','v':'ğ¯','w':'ğ°','x':'ğ±','y':'ğ²','z':'ğ³','0':'ğŸ','1':'ğŸ','2':'ğŸ','3':'ğŸ‘','4':'ğŸ’','5':'ğŸ“','6':'ğŸ”','7':'ğŸ•','8':'ğŸ–','9':'ğŸ—'},
        'sans-serif': {'A':'ğ–¯','B':'ğ–¡','C':'ğ–¢','D':'ğ–£','E':'ğ–¤','F':'ğ–¥','G':'ğ–¦','H':'ğ–§','I':'ğ–¨','J':'ğ–©','K':'ğ–ª','L':'ğ–«','M':'ğ–¬','N':'ğ–­','O':'ğ–®','P':'ğ–¯','Q':'ğ–°','R':'ğ–±','S':'ğ–²','T':'ğ–³','U':'ğ–´','V':'ğ–µ','W':'ğ–¶','X':'ğ–·','Y':'ğ–¸','Z':'ğ–¹','a':'ğ—‰','b':'ğ—Š','c':'ğ–¼','d':'ğ–½','e':'ğ–¾','f':'ğ–¿','g':'ğ—€','h':'ğ—','i':'ğ—‚','j':'ğ—ƒ','k':'ğ—„','l':'ğ—…','m':'ğ—†','n':'ğ—‡','o':'ğ—ˆ','p':'ğ—‰','q':'ğ—Š','r':'ğ—‹','s':'ğ—Œ','t':'ğ—','u':'ğ—','v':'ğ—','w':'ğ—','x':'ğ—‘','y':'ğ—’','z':'ğ—“','0':'ğŸ¢','1':'ğŸ£','2':'ğŸ¤','3':'ğŸ¥','4':'ğŸ¦','5':'ğŸ§','6':'ğŸ¨','7':'ğŸ©','8':'ğŸª','9':'ğŸ«'},
        'bold-sans-serif': {'A':'ğ—£','B':'ğ—•','C':'ğ—–','D':'ğ——','E':'ğ—˜','F':'ğ—™','G':'ğ—š','H':'ğ—›','I':'ğ—œ','J':'ğ—','K':'ğ—','L':'ğ—Ÿ','M':'ğ— ','N':'ğ—¡','O':'ğ—¢','P':'ğ—£','Q':'ğ—¤','R':'ğ—¥','S':'ğ—¦','T':'ğ—§','U':'ğ—¨','V':'ğ—©','W':'ğ—ª','X':'ğ—«','Y':'ğ—¬','Z':'ğ—­','a':'ğ—½','b':'ğ—¯','c':'ğ—°','d':'ğ—±','e':'ğ—²','f':'ğ—³','g':'ğ—´','h':'ğ—µ','i':'ğ—¶','j':'ğ—·','k':'ğ—¸','l':'ğ—¹','m':'ğ—º','n':'ğ—»','o':'ğ—¼','p':'ğ—½','q':'ğ—¾','r':'ğ—¿','s':'ğ˜€','t':'ğ˜','u':'ğ˜‚','v':'ğ˜ƒ','w':'ğ˜„','x':'ğ˜…','y':'ğ˜†','z':'ğ˜‡','0':'ğŸ¬','1':'ğŸ­','2':'ğŸ®','3':'ğŸ¯','4':'ğŸ°','5':'ğŸ±','6':'ğŸ²','7':'ğŸ³','8':'ğŸ´','9':'ğŸµ'},
        'italic-sans-serif': {'A':'ğ˜—','B':'ğ˜‰','C':'ğ˜Š','D':'ğ˜‹','E':'ğ˜Œ','F':'ğ˜','G':'ğ˜','H':'ğ˜','I':'ğ˜','J':'ğ˜‘','K':'ğ˜’','L':'ğ˜“','M':'ğ˜”','N':'ğ˜•','O':'ğ˜–','P':'ğ˜—','Q':'ğ˜˜','R':'ğ˜™','S':'ğ˜š','T':'ğ˜›','U':'ğ˜œ','V':'ğ˜','W':'ğ˜','X':'ğ˜Ÿ','Y':'ğ˜ ','Z':'ğ˜¡','a':'ğ˜±','b':'ğ˜£','c':'ğ˜¤','d':'ğ˜¥','e':'ğ˜¦','f':'ğ˜§','g':'ğ˜¨','h':'ğ˜©','i':'ğ˜ª','j':'ğ˜«','k':'ğ˜¬','l':'ğ˜­','m':'ğ˜®','n':'ğ˜¯','o':'ğ˜°','p':'ğ˜±','q':'ğ˜²','r':'ğ˜³','s':'ğ˜´','t':'ğ˜µ','u':'ğ˜¶','v':'ğ˜·','w':'ğ˜¸','x':'ğ˜¹','y':'ğ˜º','z':'ğ˜»','0':'ğŸ¬','1':'ğŸ­','2':'ğŸ®','3':'ğŸ¯','4':'ğŸ°','5':'ğŸ±','6':'ğŸ²','7':'ğŸ³','8':'ğŸ´','9':'ğŸµ'},
        'script-bold': {'A':'ğ’«','B':'ğ’¬','C':'ğ’','D':'ğ’Ÿ','E':'â„°','F':'â„±','G':'ğ’¢','H':'â„‹','I':'â„','J':'ğ’¥','K':'ğ’¦','L':'â„’','M':'â„³','N':'ğ’©','O':'ğ’ª','P':'ğ’«','Q':'ğ’¬','R':'â„›','S':'ğ’®','T':'ğ’¯','U':'ğ’°','V':'ğ’±','W':'ğ’²','X':'ğ’³','Y':'ğ’´','Z':'ğ’µ','a':'ğ“ª','b':'ğ“«','c':'ğ“¬','d':'ğ“­','e':'ğ“®','f':'ğ“¯','g':'ğ“°','h':'ğ“±','i':'ğ“²','j':'ğ“³','k':'ğ“´','l':'ğ“µ','m':'ğ“¶','n':'ğ“·','o':'ğ“¸','p':'ğ“¹','q':'ğ“º','r':'ğ“»','s':'ğ“¼','t':'ğ“½','u':'ğ“¾','v':'ğ“¿','w':'ğ”€','x':'ğ”','y':'ğ”‚','z':'ğ”ƒ','0':'ğŸ¬','1':'ğŸ­','2':'ğŸ®','3':'ğŸ¯','4':'ğŸ°','5':'ğŸ±','6':'ğŸ²','7':'ğŸ³','8':'ğŸ´','9':'ğŸµ'},
        'script': {'A':'ğ“Ÿ','B':'ğ“ ','C':'ğ“’','D':'ğ““','E':'ğ“”','F':'ğ“•','G':'ğ“–','H':'ğ“—','I':'ğ“˜','J':'ğ“™','K':'ğ“š','L':'ğ“›','M':'ğ“œ','N':'ğ“','O':'ğ“','P':'ğ“Ÿ','Q':'ğ“ ','R':'ğ“¡','S':'ğ“¢','T':'ğ“£','U':'ğ“¤','V':'ğ“¥','W':'ğ“¦','X':'ğ“§','Y':'ğ“¨','Z':'ğ“©','a':'ğ“¹','b':'ğ“º','c':'ğ“¬','d':'ğ“­','e':'ğ“®','f':'ğ“¯','g':'ğ“°','h':'ğ“±','i':'ğ“²','j':'ğ“³','k':'ğ“´','l':'ğ“µ','m':'ğ“¶','n':'ğ“·','o':'ğ“¸','p':'ğ“¹','q':'ğ“º','r':'ğ“»','s':'ğ“¼','t':'ğ“½','u':'ğ“¾','v':'ğ“¿','w':'ğ”€','x':'ğ”','y':'ğ”‚','z':'ğ”ƒ','0':'ğŸ¬','1':'ğŸ­','2':'ğŸ®','3':'ğŸ¯','4':'ğŸ°','5':'ğŸ±','6':'ğŸ²','7':'ğŸ³','8':'ğŸ´','9':'ğŸµ'},
        'monospace': {'A':'ğ™¿','B':'ğ™±','C':'ğ™²','D':'ğ™³','E':'ğ™´','F':'ğ™µ','G':'ğ™¶','H':'ğ™·','I':'ğ™¸','J':'ğ™¹','K':'ğ™º','L':'ğ™»','M':'ğ™¼','N':'ğ™½','O':'ğ™¾','P':'ğ™¿','Q':'ğš€','R':'ğš','S':'ğš‚','T':'ğšƒ','U':'ğš„','V':'ğš…','W':'ğš†','X':'ğš‡','Y':'ğšˆ','Z':'ğš‰','a':'ğš™','b':'ğš‹','c':'ğšŒ','d':'ğš','e':'ğš','f':'ğš','g':'ğš','h':'ğš‘','i':'ğš’','j':'ğš“','k':'ğš”','l':'ğš•','m':'ğš–','n':'ğš—','o':'ğš˜','p':'ğš™','q':'ğšš','r':'ğš›','s':'ğšœ','t':'ğš','u':'ğš','v':'ğšŸ','w':'ğš ','x':'ğš¡','y':'ğš¢','z':'ğš£','0':'ğŸ¶','1':'ğŸ·','2':'ğŸ¸','3':'ğŸ¹','4':'ğŸº','5':'ğŸ»','6':'ğŸ¼','7':'ğŸ½','8':'ğŸ¾','9':'ğŸ¿'},
        'fraktur': {'A':'ğ”“','B':'ğ””','C':'â„­','D':'ğ”‡','E':'ğ”ˆ','F':'ğ”‰','G':'ğ”Š','H':'â„Œ','I':'â„‘','J':'ğ”','K':'ğ”','L':'ğ”','M':'ğ”','N':'ğ”‘','O':'ğ”’','P':'ğ”“','Q':'ğ””','R':'â„œ','S':'ğ”–','T':'ğ”—','U':'ğ”˜','V':'ğ”™','W':'ğ”š','X':'ğ”›','Y':'ğ”œ','Z':'â„¨','a':'ğ”­','b':'ğ”®','c':'ğ” ','d':'ğ”¡','e':'ğ”¢','f':'ğ”£','g':'ğ”¤','h':'ğ”¥','i':'ğ”¦','j':'ğ”§','k':'ğ”¨','l':'ğ”©','m':'ğ”ª','n':'ğ”«','o':'ğ”¬','p':'ğ”­','q':'ğ”®','r':'ğ”¯','s':'ğ”°','t':'ğ”±','u':'ğ”²','v':'ğ”³','w':'ğ”´','x':'ğ”µ','y':'ğ”¶','z':'ğ”·','0':'ğŸ¶','1':'ğŸ·','2':'ğŸ¸','3':'ğŸ¹','4':'ğŸº','5':'ğŸ»','6':'ğŸ¼','7':'ğŸ½','8':'ğŸ¾','9':'ğŸ¿'},
        'double-struck': {'A':'ğ”¸','B':'ğ”¹','C':'â„‚','D':'ğ”»','E':'ğ”¼','F':'ğ”½','G':'ğ”¾','H':'â„','I':'ğ•€','J':'ğ•','K':'ğ•‚','L':'ğ•ƒ','M':'ğ•„','N':'â„•','O':'ğ•†','P':'â„™','Q':'â„š','R':'â„','S':'ğ•Š','T':'ğ•‹','U':'ğ•Œ','V':'ğ•','W':'ğ•','X':'ğ•','Y':'ğ•','Z':'â„¤','a':'ğ•’','b':'ğ•“','c':'ğ•”','d':'ğ••','e':'ğ•–','f':'ğ•—','g':'ğ•˜','h':'ğ•™','i':'ğ•š','j':'ğ•›','k':'ğ•œ','l':'ğ•','m':'ğ•','n':'ğ•Ÿ','o':'ğ• ','p':'ğ•¡','q':'ğ•¢','r':'ğ•£','s':'ğ•¤','t':'ğ•¥','u':'ğ•¦','v':'ğ•§','w':'ğ•¨','x':'ğ•©','y':'ğ•ª','z':'ğ•«','0':'ğŸ˜','1':'ğŸ™','2':'ğŸš','3':'ğŸ›','4':'ğŸœ','5':'ğŸ','6':'ğŸ','7':'ğŸŸ','8':'ğŸ ','9':'ğŸ¡'},
        'circled': {'A':'â’¶','B':'â’·','C':'â’¸','D':'â’¹','E':'â’º','F':'â’»','G':'â’¼','H':'â’½','I':'â’¾','J':'â’¿','K':'â“€','L':'â“','M':'â“‚','N':'â“ƒ','O':'â“„','P':'â“…','Q':'â“†','R':'â“‡','S':'â“ˆ','T':'â“‰','U':'â“Š','V':'â“‹','W':'â“Œ','X':'â“','Y':'â“','Z':'â“','a':'â“','b':'â“‘','c':'â“’','d':'â““','e':'â“”','f':'â“•','g':'â“–','h':'â“—','i':'â“˜','j':'â“™','k':'â“š','l':'â“›','m':'â“œ','n':'â“','o':'â“','p':'â“Ÿ','q':'â“ ','r':'â“¡','s':'â“¢','t':'â“£','u':'â“¤','v':'â“¥','w':'â“¦','x':'â“§','y':'â“¨','z':'â“©','0':'â“ª','1':'â‘ ','2':'â‘¡','3':'â‘¢','4':'â‘£','5':'â‘¤','6':'â‘¥','7':'â‘¦','8':'â‘§','9':'â‘¨'},
        'regional': {'A':'ğŸ‡¦','B':'ğŸ‡§','C':'ğŸ‡¨','D':'ğŸ‡©','E':'ğŸ‡ª','F':'ğŸ‡«','G':'ğŸ‡¬','H':'ğŸ‡­','I':'ğŸ‡®','J':'ğŸ‡¯','K':'ğŸ‡°','L':'ğŸ‡±','M':'ğŸ‡²','N':'ğŸ‡³','O':'ğŸ‡´','P':'ğŸ‡µ','Q':'ğŸ‡¶','R':'ğŸ‡·','S':'ğŸ‡¸','T':'ğŸ‡¹','U':'ğŸ‡º','V':'ğŸ‡»','W':'ğŸ‡¼','X':'ğŸ‡½','Y':'ğŸ‡¾','Z':'ğŸ‡¿','0':'â‚€','1':'â‚','2':'â‚‚','3':'â‚ƒ','4':'â‚„','5':'â‚…','6':'â‚†','7':'â‚‡','8':'â‚ˆ','9':'â‚‰'},
      };

      function transformText(text, fontStyle) {
        const transformMap = fontTransformations[fontStyle];
        if (!transformMap || Object.keys(transformMap).length === 0) return text;
        
        let result = '';
        for (const char of text) {
          result += transformMap[char.toUpperCase()] || transformMap[char] || char;
        }
        return result.replace(/undefined/g, ''); // Safety net
      }
      
      function generate() {
        const systemSelect = document.getElementById('systemSelect');
        const systemText = systemSelect.value === 'other' ? document.getElementById('systemOther').value : systemSelect.value || '';
        
        const scenarioName = document.getElementById('scenarioName').value || '';
        const authorName = document.getElementById('authorName').value || '';
        const scenarioFrame = document.querySelector('input[name=scenarioFrame]:checked')?.value || '';
        const decoratedScenario = decorateScenario(scenarioName, scenarioFrame);
        const authorLine = authorName ? `ä½œè€…ï¼š${authorName}` : "";
        const scenarioBlock = [decoratedScenario, authorLine].filter(Boolean).join('\n');
        
        const headerBlock = [systemText, scenarioBlock].filter(Boolean).join('\n\n');
        
        const roleMode = document.getElementById('roleSelect').value;
        const font = document.querySelector('input[name=font]:checked')?.value || 'normal';
        
        let roleOutput = "";
        let pcplOutput = "";

        const pcplFormat = document.querySelector('input[name="pcplFormat"]:checked')?.value || 'A';
        const prefixType = document.querySelector('input[name="prefixType"]:checked')?.value || 'HO';
        let pcplLines = [];
        let hasPlayerInfo = false;

        if (roleMode === 'KPC') {
            const kpcName = document.getElementById('kpcName').value || '';
            const kpName = document.getElementById('kpName').value || '';
            const kpcplPart = [kpcName, kpName].filter(Boolean).join(' / ');
            if (kpcplPart) {
                roleOutput = `${transformText('KPC', font)}ï¼š${kpcplPart}`;
            }
        } else {
            let roleType = document.querySelector('select[name=standardRoleType]').value;
            let roleLabel = roleType === 'other' ? document.getElementById('standardRoleTypeOther').value : roleType || '';
            const roleName = document.getElementById('roleName').value;
            if (roleLabel && roleName) {
                roleOutput = `${transformText(roleLabel, font)}ï¼š${roleName}`;
            }
        }
        
        // Unified Player Block generation
        for (let i = 1; i <= playerCount; i++) {
            const hoValue = document.getElementById(`ho${i}`)?.value || '';
            const pcValue = document.getElementById(`pc${i}`)?.value;
            const plValue = document.getElementById(`pl${i}`)?.value;

            if (pcValue || plValue) {
                hasPlayerInfo = true;
                let pcplPart = [pcValue, plValue].filter(Boolean).join(' / ');

                if (pcplFormat === 'D') {
                    pcplLines.push(pcplPart);
                    continue;
                }

                let headerPart = "";
                const effectivePrefix = (roleMode === 'KPC') ? 'PC' : prefixType;
                
                const numberLabel = (playerCount === 1 && roleMode === 'KPC') 
                    ? transformText(effectivePrefix, font)
                    : transformText(effectivePrefix + i, font);
                
                switch(pcplFormat) {
                  case 'A': headerPart = numberLabel + (hoValue ? `ï¼š${hoValue}` : ''); break;
                  case 'B': if (hoValue) headerPart = hoValue; break;
                  case 'C': headerPart = numberLabel; break;
                }
                pcplLines.push([headerPart, pcplPart].filter(Boolean).join('ã€€'));
            }
        }
        
        if(hasPlayerInfo) {
            if(pcplFormat === 'D') {
                const listHeader = `${transformText('PC', font)} / ${transformText('PL', font)}`;
                pcplOutput = `${listHeader}\n${pcplLines.join('\n')}`;
            } else {
                pcplOutput = pcplLines.join('\n');
            }
        }
        
        const roleAndPcBlock = [roleOutput, pcplOutput].filter(Boolean).join('\n\n');

        const ending = document.querySelector('select[name=ending]').value;
        let endingText = ending === 'other' ? document.getElementById('endingOther').value : ending || '';

        const result = document.querySelector('select[name=result]').value;
        let resultText = result === 'other' ? document.getElementById('resultOther').value : result || '';
        
        let resultOutput = "";
        if (endingText || resultText) {
          if(endingText) resultOutput += endingText;
          if (resultText) resultOutput += (resultOutput ? '\n' : '') + `â–¸ ${resultText}ã«ã¦ã‚·ãƒŠãƒªã‚ªçµ‚äº†`;
        }
        
        const comment = document.getElementById('comment').value;

        let finalOutput = [headerBlock, roleAndPcBlock, resultOutput, comment]
            .filter(Boolean).join('\n\n').trim();

        document.getElementById('previewOutput').textContent = finalOutput;

        const count = finalOutput.length;
        const countElem = document.getElementById('charCount');
        countElem.textContent = `æ–‡å­—æ•°: ${count}`;
        countElem.classList.toggle('text-red-400', count > 140);
        countElem.classList.toggle('text-gray-400', count <= 140);
      }
      
      function decorateScenario(name, frameValue) {
        if (!name) return "";
        const content = name;
        const frames = {
          'ã€Œã€': `ã€Œ${content}ã€`, 'ã€ã€': `ã€${content}ã€`, 'ã€ã€‘': `ã€${content}ã€‘`,
          'â”€â”€â”€â”€â”€â”€': `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  ${content}\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`,
          'â—¤â—¢': `â—¤ ${content} â—¢`,
          'â•‹â”â”â”â”â”â”â”â”': `â•‹â”â”â”â”â”â”â”â”\n  ${content}\nâ”â”â”â”â”â”â”â”â•‹`,
          'ï¼Šâ”€â”€â”€â”€â”€â”€â”€': `ï¼Šâ”€â”€â”€â”€â”€â”€â”€â”€â”€\n  ${content}\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€ï¼Š`,
          'â€¢â€¢â”ˆâ”ˆâ”ˆâ”ˆ': `â€¢â€¢â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ€¢â€¢\n  ${content}\nâ€¢â€¢â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ€¢â€¢`,
          'âœ¼': `âœ¼â€¢â€¢â”ˆâ”ˆâ€¢â€¢âœ¼â€¢â€¢â”ˆâ”ˆâ€¢â€¢âœ¼\n  ${content}\nâœ¼â€¢â€¢â”ˆâ”ˆâ€¢â€¢âœ¼â€¢â€¢â”ˆâ”ˆâ€¢â€¢âœ¼`,
          'âœ¦': `âœ¦ âŠ¹ ï½¡ ï¾ŸË– âœ§ âŠ¹ ï½¡ ï¾Ÿâ– Â°âœ¦\n  ${content}\nâœ¦ âŠ¹ ï½¡ ï¾ŸË– âœ§ âŠ¹ ï½¡ ï¾Ÿâ– Â°âœ¦`,
          'â–¹â–¸': `â–¹â–¸ ãƒ¼ ãƒ¼ ãƒ¼ ãƒ¼ ãƒ¼ ãƒ¼\n  ${content}\nãƒ¼ ãƒ¼ ãƒ¼ ãƒ¼ ãƒ¼ ãƒ¼ â—ƒâ—‚`,
          'ï¼ï¼': `ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n  ${content}\nï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼`,
          'â–¼â–³': `â–¼â–³â–¼â–³â–¼â–³â–¼â–³â–¼â–³â–¼â–³\n  ${content}\nâ–¼â–³â–¼â–³â–¼â–³â–¼â–³â–¼â–³â–¼â–³`,
          'â˜†â˜…': `â˜†.ï½¡:ï½¥â˜….ï½¡:*ï½¥â˜†.ï½¡:*ï½¥\n  ${content}\nï½¡:*ï½¥â˜….ï½¡:*ï½¥â˜†.ï½¡â˜†.ï½¡`,
          'oâ—‹o': `oâ—‹oã€‚.ã€‚oâ—‹oã€‚.ã€‚oâ—‹o\n  ${content}\n  oâ—‹oã€‚.ã€‚oâ—‹oã€‚.ã€‚oâ—‹o`,
          'âŒ’âŒ’': `âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’\n  ${content}\nâŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’âŒ’`,
          'à¬˜â™¡à¬“': `à¬˜â™¡à¬“*:ã‚š+ï½¡.à»’ê’±Â°*à¬˜â™¡à¬“\n  ${content}\nà¬˜â™¡à¬“*:ã‚š+ï½¡.à»’ê’±Â°*à¬˜â™¡à¬“`
        };
        const key = Object.keys(frames).find(k => k.includes(frameValue)) || frameValue;
        return frames[key] || content;
      }

      function copyToClipboard() {
          const textToCopy = document.getElementById('previewOutput').textContent;
          if (navigator.clipboard && window.isSecureContext) {
              navigator.clipboard.writeText(textToCopy).then(showCopySuccess, () => console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ'));
          } else {
              const textArea = document.createElement("textarea");
              textArea.value = textToCopy;
              textArea.style.position = "fixed"; textArea.style.left = "-9999px";
              document.body.appendChild(textArea);
              textArea.focus(); textArea.select();
              try {
                  document.execCommand('copy');
                  showCopySuccess();
              } catch (err) {
                  console.error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', err);
              }
              document.body.removeChild(textArea);
          }
      }

      function showCopySuccess() {
          const statusElem = document.getElementById('copy-status');
          statusElem.classList.remove('opacity-0');
          setTimeout(() => statusElem.classList.add('opacity-0'), 2000);
      }
      
      // --- åˆæœŸåŒ– ---
      for (let i = 1; i <= playerCount; i++) {
        playersDiv.insertAdjacentHTML('beforeend', createPlayerHTML(i));
      }
      handleRoleChange(); // To set initial visibility
      generate();
      updateRadioStyles('scenarioFrame');
      updateRadioStyles('font');
      updateRadioStyles('pcplFormat');
      updateRadioStyles('prefixType');
      updatePlayerFieldsVisibility();
    });
  </script>
</body>
</html>
